<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Processing...</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="text-center">
    <svg class="animate-spin h-10 w-10 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
    </svg>
    <p class="mt-4 text-gray-700">Waiting for M-PESA confirmation...</p>
  </div>
  <script>
    const checkout = localStorage.getItem('checkoutId');
    const duration = localStorage.getItem('duration');

    // Poll for payment confirmation
    async function poll() {
      try {
        const res = await fetch(`https://your-proxy.com/mpesa/status/${checkout}`);
        const { status } = await res.json();
        if (status === 'Completed') return loginToRouter();
      } catch {}
      setTimeout(poll, 3000);
    }
    poll();

    // On payment success, redirect to MikroTik login
    function loginToRouter() {
      const params = new URLSearchParams(window.location.search);
      const loginURL = `/login?username=${params.get('mac')}&password=${params.get('ip')}&dst=${params.get('dst')}`;
      window.location.href = loginURL;
    }
  </script>
</body>
</html>